<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>

<th:block th:fragment="editEntry(entry)">
    <div data-entry
         hx-on="htmx:load:showFields(this.querySelector('select[name=type]'))"
         class="group relative rounded-lg bg-blue-50 p-3 shadow-sm hover:bg-blue-100 transition">
        <form hx-post="/edit" hx-target="closest [data-entry]" th:id="|form-${entry.id}|" hx-swap="outerHTML"
              name="edit">
            <input th:if="${entry}" type="hidden" name="id" th:value="${entry.id}"/>
            <select name="type" onchange="showFields(this)" class="shrink-0 border rounded px-2 py-1">
                <option th:each="type : ${T(demo.web.EntryType).values()}"
                        th:value="${type}"
                        th:selected="${type == entry.type}"
                        th:text="${type}">
                </option>
            </select>

            <div name="fields">
                <div class="field Breakpoint hidden">
                    <textarea
                            name="comments"
                            placeholder="Comments..."
                            th:text="${entry.comments}"
                            rows="10"
                            class="block w-full resize-y overflow-auto border rounded px-2 py-1 font-mono">
                    </textarea>
                </div>

                <div class="field Command hidden">
                    <textarea
                            name="commands"
                            placeholder="Commands..."
                            th:text="${entry.commands}"
                            rows="10"
                            class="block w-full resize-y overflow-auto border rounded px-2 py-1 font-mono">
                    </textarea>
                </div>

                <div class="field DisplayFile hidden">
                    <label>File Path</label>
                    <input type="text" name="path" placeholder="File path" th:value="${entry.path}"/>
                    <label>Content Type</label>
                    <input type="text" name="contentType" placeholder="Content type" th:value="${entry.contentType}"/>
                    <label>From line number (1 based)</label>
                    <input type="text" name="fromLine" placeholder="From line" th:value="${entry.fromLine}"/>
                    <label>Number of lines</label>
                    <input type="text" name="numberOfLines" placeholder="Number of lines" th:value="${entry.numberOfLines}"/>
                    <label>Indent</label>
                    <input type="text" name="indent" placeholder="Indent" th:value="${entry.indent}"/>
                </div>

                <div class="field Heading flex items-center gap-2 min-w-0 hidden">
                    <select name="level" class="shrink-0 border rounded px-2 py-1">
                        <option th:each="type : ${T(demo.domain.Heading.HeadingLevel).values()}"
                                th:value="${type}"
                                th:selected="${type == entry.level}"
                                th:text="${type}"></option>
                    </select>
                    <input type="text"
                           name="title"
                           placeholder="Heading..."
                           th:value="${entry.title}"
                           class="flex-1 min-w-0 border rounded px-2 py-1"/>
                </div>

                <div class="field Markdown hidden">
                    <textarea
                        name="contents"
                        placeholder="Markdown..."
                        th:text="${entry.contents}"
                        rows="10"
                        class="block w-full resize-y overflow-auto border rounded px-2 py-1 font-mono">
                    </textarea>
                </div>

                <div class="field Todo hidden">
                    <textarea
                            name="comments"
                            placeholder="Comments..."
                            th:text="${entry.comments}"
                            rows="10"
                            class="block w-full resize-y overflow-auto border rounded px-2 py-1 font-mono">
                    </textarea>
                </div>
            </div>

            <div class="mt-1 flex items-center gap-2 text-xs">
                <button
                        type="submit"
                        name="update"
                        class="inline-flex items-center rounded bg-blue-600 px-2 py-0.5 text-white hover:bg-blue-700 focus:outline-none focus:ring-1 focus:ring-blue-500 focus:ring-offset-1">
                    Update
                </button>

                <button
                        type="button"
                        name="cancel"
                        th:hx-get="@{/{id}(id=${entry.id})}"
                        hx-target="closest [data-entry]"
                        hx-swap="outerHTML"
                        class="text-blue-600 hover:underline focus:outline-none">
                    Cancel
                </button>
            </div>
        </form>
    </div>
</th:block>

<th:block th:fragment="renderEntry(entry)">
    <div data-entry
         class="group relative rounded-lg bg-white p-3 shadow-sm hover:bg-gray-50 transition">
        <th:block th:utext="${entry.contents}"/>
        <div class="mt-2 flex flex-wrap items-center gap-2">
            <input type="hidden" name="id" th:value="${entry.id}"/>
            <button
                    name="edit"
                    class="inline-flex items-center rounded-md border border-gray-300 bg-white px-2 py-0.5 text-[10px] font-medium text-gray-700 hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                    hx-get="/edit"
                    hx-target="closest [data-entry]"
                    hx-swap="outerHTML"
                    hx-include="closest div">
                Edit
            </button>
            <button
                    name="delete"
                    class="inline-flex items-center rounded-md border border-red-300 bg-white px-2 py-0.5 text-[10px] font-medium text-red-600 hover:bg-red-50 focus:outline-none focus:ring-2 focus:ring-red-500"
                    hx-delete="/delete"
                    hx-target="closest [data-entry]"
                    hx-swap="outerHTML"
                    hx-include="closest div">
                Delete
            </button>
            <label class="flex items-center gap-2 text-xs text-gray-500">
                <span class="whitespace-nowrap">Add</span>
                <select name="type"
                        class="rounded-md border border-gray-300 bg-white px-2 py-0.5 text-[10px] text-gray-700 focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        hx-post="/after"
                        hx-trigger="change"
                        hx-target="closest [data-entry]"
                        hx-swap="afterend"
                        hx-include="closest div">
                    <option th:each="type : ${T(demo.web.EntryType).values()}"
                            th:value="${type}"
                            th:text="${type}"></option>
                </select>
            </label>
        </div>
    </div>
</th:block>

<th:block th:fragment="undoDelete">
    <div data-entry
         class="group relative rounded-lg bg-orange-50 p-3 shadow-sm hover:bg-orange-100 transition">
        <span class="whitespace-nowrap" data-deleted-entry>Entry deleted</span>
        <input type="hidden" name="id" th:value="${id}"/>
        <button name="undo"
                hx-post="/undo"
                hx-target="closest [data-entry]"
                hx-swap="outerHTML"
                hx-include="closest div"
                class="text-blue-600 hover:underline focus:outline-none">
            Undo
        </button>
    </div>
</th:block>

<th:block th:fragment="cannotUndoDelete">
    <div data-entry
         class="group relative rounded-lg bg-red-50 p-3 shadow-sm hover:bg-red-100 transition whitespace-nowrap">
        <span class="whitespace-nowrap" data-cannot-undo-delete>Deletion cannot be undone</span>
    </div>
</th:block>

</body>
</html>
